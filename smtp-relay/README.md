# SMTP-RELAY
> SMTP中继服务
XYHELPER SMTP中继服务，用于将邮件发送服务独立部署,避免泄漏主服务的IP地址。

## 介绍
- 项目类型: 免费不开源
- 项目地址: [https://github.com/xyhelper/xyhelper-smtp-relay-deploy](https://github.com/xyhelper/xyhelper-smtp-relay-deploy)

## 部署

- 服务器要求
  - 1核1G内存
  - 10G硬盘
  - Ubuntu 20.04+
  - 已安装 Docker 和 Docker-Compose
  - 服务商未限制SMTP协议的使用


## 扩展阅读


### 服务器直接使用SMTP协议发送邮件会暴露源IP问题解析

在日常运维和开发中，很多服务器需要通过SMTP协议发送邮件，例如报警通知、注册验证等。然而，直接在服务器上使用SMTP协议发送邮件，往往会带来一个被忽视的安全隐患——服务器的真实IP地址可能会被暴露。


#### SMTP协议简介

SMTP（Simple Mail Transfer Protocol，简单邮件传输协议）是互联网中用于传输电子邮件的标准协议。服务器通过SMTP协议将邮件发送到收件人邮箱服务器。


#### 源IP暴露的原理

当服务器通过SMTP协议直接向外部邮件服务器（如Gmail、QQ邮箱等）发送邮件时，邮件头部会自动记录邮件的传输路径。常见的邮件头字段如`Received`，会包含每一跳服务器的IP地址和主机名。

例如：

```
Received: from example.com (example.com [203.0.113.1])
	by mx.google.com with ESMTPS id ...
```

其中`203.0.113.1`就是发件服务器的真实公网IP。


#### 暴露源IP的风险

1. **隐私泄露**：攻击者可以通过邮件头分析出服务器的真实IP，进而定位服务器位置。
2. **被攻击风险增加**：一旦IP暴露，服务器更容易成为DDoS、暴力破解等攻击的目标。
3. **绕过防护**：即使服务器做了CDN、WAF等防护，邮件头中的真实IP依然可能被泄漏。


#### 如何规避源IP暴露

1. **使用第三方邮件服务**：如SendGrid、Mailgun、阿里云邮件推送等，服务器只需通过API或SMTP中继发送邮件，外部收件人看到的IP为第三方服务的IP。
2. **自建SMTP中继服务器**：在专用的跳板机或云函数上搭建SMTP中继，所有邮件先发到中继服务器，再由中继服务器转发到外部邮箱。
3. **邮件头处理**：部分中继服务支持清理或伪装`Received`等头部信息，但并非所有服务都支持，且部分收件方会因头部异常判定为垃圾邮件。


#### 实践建议

- 生产环境下，尽量避免服务器直接对外发邮件。
- 推荐使用专业的邮件中继服务，既能保护源IP，又能提升送达率。
- 定期检查邮件头，确保没有泄漏敏感信息。


#### 总结

直接使用SMTP协议发送邮件虽然方便，但存在源IP暴露的安全隐患。通过合理配置邮件中继或使用第三方服务，可以有效保护服务器的真实IP，降低被攻击风险。

